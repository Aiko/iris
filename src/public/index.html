<!-- AIKO MAIL, INC. ALL RIGHTS RESERVED -->
<!-- TODO: Save state of interface (sidebar and boards...) so it stays same on restart (collapsed, not collapsed etc) -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Aiko AI">
  <title>Inbox</title>
  <link rel="icon" href="assets/img/favicon.png" type="image/png">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/css/loader.css">
  <script src="assets/js/third-party/jquery.min.js"></script>
  <script>
    window.jQuery = window.$ = require('jquery');
  </script>
  <!-- Using unsafe eval for Vue -->
  <!--<meta http-equiv="Content-Security-Policy"
      content="default-src 'self' data:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' data: 'unsafe-inline'; connect-src *">-->
</head>

<body class="bg" style="background-image: url('./assets/img/1.jpg')">
  <!-- TODO: If possible, add 'collapsed' when 'zen' is added so that zen doesn't exist without collapsed ever -->
  <!-- TODO: Add 'Zen Mode' in 'Window' mac menu option teehee -->
  <div id="app" :class="{
    'inline-flex': true,
    'collapsed': collapseSidebar
  }" style="opacity: 0" :style="'padding-top: ' + (isFullScreen ? '0' : '20') + 'px;'">
    <!-- THEMES GO HERE -->
    <link v-if="isDarkMode" rel="stylesheet" href="assets/css/dark.css">
    <!-- LOADER -->
    <!-- TODO: MAKE INITIAL LOADER ONLY APPEAR AFTER INBOX IS ADDED SO THAT LOAD TEXT SHOWS ENTIRELY -->
    <div id="fixed" class="aiko-loader center-loader">
      <div class="hide-whole"></div>
      <img src="assets/img/logo.svg">
      <div class="overwrap">
        <div class='wrap'>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
        </div>
      </div>
      <div id="load-text">Optimizing content</div>
      <div id="load-text2">Setting up your mailbox</div>
      <div id="load-text3">Almost done</div>
      <div id="load-text4">This will only happen once</div>
      <div id="load-text5">Just a moment</div>
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-primary wv" data-toggle="modal" data-target="#initVideo">
        Watch a demo video while you wait
      </button>
      <!-- Modal -->
      <div class="modal fade" id="initVideo" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <video controls src="assets/videos/initial.mp4" playsinline>
            </div>
            <div class="modal-footer">
              <p style="margin-bottom: 0;">You can skip this video once we're done setting up your
                mailbox.</p>
              <!-- TODO: SHOW THIS BUTTON ONLY WHEN APP IS READY -->
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Skip Video</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTROL BAR -->
    <div :class="{'control-bar': true,'pc': isPC,}" v-if="!isFullScreen">
      <p v-if="isLinux" title="Close" @click="close"></p> <!-- Close ------------------------>
      <p v-if="isLinux" title="Minimize" @click="minimize"></p> <!-- Minimize ------------------------>
      <p v-if="isLinux" title="Full Screen" @click="fullscreen"></p> <!-- Full Screen ------------------------>

      <h5 @click="showDev = true">{{hash.substring(0, 9)}}</h5>

      <h1 title="Minimize" @click="minimize"><img src="assets/icons/top-minimize.png" width="10"></h1>
      <!-- Minimize ---------->
      <h1 v-if="!isMaximized" title="Maximize" @click="maximize"><img src="assets/icons/top-expand.png" width="10">
      </h1>
      <h1 v-if="isMaximized" title="Unmaximize" @click="unmaximize"><img src="assets/icons/top-expand.png" width="10">
      </h1>
      <!-- Maximize -->
      <h1 title="Close" @click="close"><img src="assets/icons/top-close.png" width="10"></h1>
      <!-- Close ---------------->
    </div>
    <!-- Sidebar --------------------------------------------------->
    <div class="sidebar">
      <div class="container">
        <div class="row">
          <a class="compose" @click="openComposer()"><img src="assets/icons/sidebar-edit.svg"
              style="margin-right: 6px;"><span>Compose</span></a>
          <a class="active"><img src="assets/icons/sidebar-home.svg"> <span>Home <span
                class="main-count">3</span></span></a>
          <a><img src="assets/icons/sidebar-send.svg" class="sent-fix"> <span>Sent</span></a>
          <a><img src="assets/icons/sidebar-star.svg" class="off-star"><span> Starred</span></a>
          <a><img src="assets/icons/sidebar-spam.svg" style="margin-top: -2px !important;"><span>
              Spam</span></a>
          <a><img src="assets/icons/sidebar-drafts.svg"> <span>Drafts</span></a>
          <a><img src="assets/icons/sidebar-trash.svg"> <span>Trash</span></a>
        </div>
        <div class="row">
          <div class="search no-mobile sc">
            <img src="assets/icons/header-search.svg"><input type="" name="" placeholder="Search Team">
          </div>
          <div style="height: 30px"></div>
          <div class="user-list">
            <a class="user" v-for="user in profile.team.team">
              <div class="active-user"></div>
              <!-- TODO: on server change user.pictureURI to be from assets/ default -->
              <!-- TODO: can we fetch and download people's gmail profile pic? -->
              <img :src="'assets/' + (user.member.pictureURI || 'img/avatar.png')">
              <div class="no-mobile sc">{{user.member.name}}</div>
            </a>
          </div>
          <a class="invite-icon" tflow="down"><img src="assets/icons/sidebar-invite.svg"> <span
              class="blue sc">Invite</span></a>
          <div class="version sc no-mobile">
            <h1>Version: <span class="blue fw700">ALPHA</span></h1>
            <p>Request features and report issues</p>
            <a target="_blank">Give feedback</a>
          </div>
        </div>
        <div class="row bottom">
          <div @click="collapseSidebar = !collapseSidebar" title="Toggle collapse sidebar"
            class="sidebar-collapse no-mobile">
            <img src="assets/icons/sidebar-collapse.svg">
          </div>
          <br>
          <div class="set">
            <a><img src="assets/icons/sidebar-settings.svg" width="30"></a>
            <a tooltip="Documentation" class="no-mobile sc" target="_blank"><img src="assets/icons/sidebar-help.svg"
                width="30"></a>
          </div>
        </div>
      </div>
    </div>
    <!-- END Sidebar ----------------------------------------------->

    <!-- MAIN INBOX -->
    <div class="main">

      <!-- TOASTS (MAKE TOASTS DISAPPEAR AFTER 10 SECONDS) -->
      <!-- TOAST Invite Sent -->
      <div class="aiko-toast" style="display: none">
        <p class="textinout">Sending invite</p><a>Undo</a>
        <div class="t-loader"><span></span></div>
      </div>

      <!-- TOAST Connection Lost -->
      <div class="aiko-toast" style="display: none">
        <p class="textinout" style="color: #dc3545 !important">We're having trouble connecting to the internet</p>
        <div class="t-loader-red"><span></span></div>
      </div>

      <!-- TOAST IMAP Error -->
      <div class="aiko-toast" v-if="!connected">
        <p class="textinout" style="color: #dc3545 !important">
          We're having issues connecting to your mail provider. Trying again in {{timeToNextSync}}s...
        </p>
        <div class="t-loader-red"><span></span></div>
      </div>

      <!-- TOAST Send Email Error -->
      <div class="aiko-toast" style="display: none;">
        <p class="textinout" style="color: #dc3545 !important">We were unable to send your message due to network
          issues</p>
        <div class="t-loader-red"><span></span></div>
      </div>

      <!-- TOAST Sending Email -->
      <div class="aiko-toast" style="display: none;">
        <p class="textinout">Sending email</p><a>Undo</a>
        <div class="t-loader"><span></span></div>
      </div>

      <!-- Header ------------------------------------------------>
      <div class="header">
        <div class="container">
          <div class="row">
            <div class="col-lg-3 col-md-4 col-2">
              <div class="picker">
                <div class="account">
                  <img src="assets/icons/header-user.svg"> <span>{{imapConfig?.email}}</span>
                </div>
                <div @click="switchMailbox(mailbox)" v-for="mailbox in mailboxes" v-if="mailbox != imapConfig?.email"
                  class="account">
                  <img src="assets/icons/header-user.svg"> <span>{{mailbox}}</span>
                </div>
                <div @click="addMailbox = true" class="account">
                  <img src="assets/icons/header-plus.svg"> <span>Add a mailbox</span>
                </div>
              </div>
            </div>
            <div class="col-lg-5 col-md-6 col-6 p0m">
              <div class="search">
                <img src="assets/icons/header-search.svg"><input type="" name="" placeholder="Search">
              </div>
              <!-- TODO: Rig search + search dropdown -->
              <div class="search-drop" style="display: none;">
                <a>
                  <div>Subject contains "<span>Ruben</span>"</div>
                </a>
                <hr>
                <p>People</p>
                <a>
                  <div>ruben@priansh.com</div>
                </a>
                <a>
                  <div>rubencharles@gmail.com</div>
                </a>
                <a>
                  <div>rubencharlestouitou@gmail.com</div>
                </a>
              </div>
            </div>
            <div class="col-lg-4 col-md-2 col-4 text-right side" style="white-space: nowrap;">
              <!--  <a class="inline"><img src="assets/icons/header-calendar.svg"></a> -->
              <div class="dropdown inline">
                <a data-toggle="dropdown"><img src="assets/icons/header-bell.svg">
                  <!-- TODO: rig notif-count, the badge notification count by the bell-->
                  <span class="notif-count">3</span></a>
                <div class="dropdown-menu notif" style="margin-top: 10px">
                  <div class="container">
                    <a>
                      <div class="row">
                        <div class="col-1">
                          <img src="assets/icons/notif-click.svg" width="10">
                        </div>
                        <div class="col-7 notif-c">
                          Ruben opened "Re: Meeting this saturday"
                        </div>
                        <div class="col-3 notif-t p0">
                          35m
                        </div>
                      </div>
                    </a>
                    <a>
                      <div class="row">
                        <div class="col-1">
                          <img src="assets/icons/notif-invite.svg" width="10">
                        </div>
                        <div class="col-7 notif-c">
                          Prinakashiose joined your team
                        </div>
                        <div class="col-3 notif-t p0">
                          3h
                        </div>
                      </div>
                    </a>
                    <a>
                      <div class="row">
                        <div class="col-1">
                          <img src="assets/icons/notif-eye.svg" width="10">
                        </div>
                        <div class="col-7 notif-c">
                          John opened "Can you meet at ..."
                        </div>
                        <div class="col-3 notif-t p0">
                          Yesterday
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- END Header -------------------------------------------->

      <div class="boards-container">
        <!-- TODO: rig settings to add 'zero-lines, one-lines, two-lines, three-lines'  to 'boards'-->
        <!-- TODO: add 'regular' class  to 'boards' class to make it regular non-board view-->
        <!-- TODO: add 'no-action-bar' class  to 'boards' class to remove action b ar from all emails-->
        <div class="boards two-lines">
          <!-- INBOX BOARD -->
          <div :class="{
            'board': true,
            'inbox': true,
            'load-board': syncingInbox
          }">
            <div class="board-header">
              <div class="container p0">
                <div class="row" style="display: -webkit-inline-box">
                  <div class="col-1 cll">
                    <div class="dropdown">
                      <a tooltip="Board options" data-toggle="dropdown"><img src="assets/icons/board-dots.svg"></a>
                      <div class="dropdown-menu">
                        <h6 class="dropdown-header">Actions</h6>
                        <a class="dropdown-item">Mark all as read</a>
                        <a class="dropdown-item">Mark all as unread</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item">Board rules</a>
                      </div>
                    </div>
                  </div>
                  <!-- TODO: Sorting sorts all boards at once-->
                  <div class="col-1 cll">
                    <div class="dropdown">
                      <a tooltip="Sort and filter emails" data-toggle="dropdown"><img src="assets/icons/sort.svg"></a>
                      <div class="dropdown-menu">
                        <h6 class="dropdown-header">Sort by</h6>
                        <a class="dropdown-item">Date (newest)</a>
                        <a class="dropdown-item">Date (oldest)</a>
                        <a class="dropdown-item">Size (largest)</a>
                        <a class="dropdown-item">Size (smallest)</a>
                        <h6 class="dropdown-header">Display only</h6>
                        <a class="dropdown-item">Unread</a>
                        <a class="dropdown-item">Read</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-1 cll">
                    <a v-if="syncing" tooltip="Force refresh">
                      <img class="rotating" src="assets/icons/refresh.svg" width="17">
                    </a>
                    <a v-if="!syncing" @click="updateAndFetch" tooltip="Force refresh">
                      <img src="assets/icons/refresh.svg" width="17">
                    </a>
                  </div>
                  <div class="col-8 text-center exp nowrap">
                    <div class="inbox-switch left text-center">
                      <!-- TODO: Add 'active' ti whichever is active, see below-->
                      <h1 :class="{
                        'inbox1': true,
                        'active': priority
                      }" @click="priority = true" inbox-direction="left">
                        Priority
                        <div class="secondary-count" tooltip="Unread emails in your inbox">
                          {{priorityInbox.filter(e=>!e.ai.seen).length}}
                        </div>
                      </h1>
                      <h1 :class="{
                        'inbox2': true,
                        'active': !priority
                      }" @click="priority = false" inbox-direction="right">Others</h1>
                    </div>


                  </div>
                </div>
              </div>
            </div>
            <!-- END List loader -------------------------->
            <div ref="inboxBoard" @scroll="onScroll" class="board-body">

              <!-- DON'T MODIFY BELOW -->
              <!-- Can use :move to prevent it from moving into this board -->
              <draggable v-if="!loading" filter=".dont-drag-this" id="aikomail--inbox" v-model="inbox.emails"
                :group="{name: 'emails', pull: 'clone'}" ghost-class="ghost" @end="moveEmail" :force-fallback="true"
                :fallback-on-body="true" :fallback-tolerance="0" draggable=".email" @clone="cloneEmail">
                <email-card :inbox="true" :key="email?.uid" :sort="false" v-for="(email, i) in inbox.emails"
                  :render="i >= visibleMin && visibleMax >= i"
                  v-if="!email?.ai?.deleted && email?.folder == 'INBOX' && priority == email?.ai?.priority && !(email?.ai?.threaded)"
                  :index="i" :focused-folder.camel="focused.folder" :focused-index.camel="focused.index"
                  :view-focused.camel="focused.view" :quick-focused.camel="focused.quickReply" :email="email">
                </email-card>
              </draggable>

              <!-- START List loader ----------------------->
              <div class="inbox-more">
                <p @click="priority = false"><img src="assets/icons/filter-inbox.svg"> <span>Click here to see
                  </span><b>{{fullInbox.length}}</b> filtered
                  <span>emails</span></p>
                <div v-if="seekingInbox" class="load-bottom">
                </div>
              </div>
              <!-- END List loader -------------------------->
            </div>
          </div>
          <!-- END Inbox Board ---------------------------->

          <!-- TODO: Boards should be draggable ----------->
          <!-- TODO: Add 'thin' to 'board' when click on board title ----------->

          <!-- START BOARDS-->

          <!-- START Default Board Template ----------------------->
          <draggable style="display: inline-flex;" v-model="boardNames" :group="{name: 'boards'}" ghost-class="ghost"
            :force-fallback="true" :fallback-on-body="true" @end="reorderBoards" draggable=".board"
            handle=".board-drag-handle">
            <board v-for="boardName in boardNames" :syncing="!!syncingBoards[boardName]" :board.sync="boards[boardName]"
              :board-name.camel="boardName" inline-template>
              <div :board-name="boardName" :class="{
                'board': true,
                'load-board': syncing,
                'thin': board?.thin
              }">
                <div class="board-header board-drag-handle">
                  <div class="container p0">
                    <div class="row">
                      <div class="col-2 cll">
                        <div class="dropdown">
                          <a tooltip="Board options" data-toggle="dropdown"><img src="assets/icons/board-dots.svg"></a>
                          <div class="dropdown-menu">
                            <h6 class="dropdown-header">Actions</h6>
                            <a class="dropdown-item">Mark all as read</a>
                            <a class="dropdown-item">Mark all as unread</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item">Board rules</a>
                            <!-- TODO: THIS IS ONLY FOR ADDED CUSTOM BOARDS <a class="dropdown-item red" style="color: #dc3545 !important">Delete board</a> -->
                          </div>
                        </div>
                      </div>
                      <div class="col-8 text-center p0 exp margin-auto nowrap">
                        <h1 @click="board.thin = !board.thin" tooltip="Click title to minimize/maximize">
                          {{prettyBoardName}}</h1>
                        <div v-if="unread > 0" class="secondary-count" tooltip="Unread emails in board">
                          {{unread > 99 ? '99+' : unread}}</div>
                      </div>
                      <div class="col-2 text-right cll">
                        <!--  TESTING A UI WITHOUT THIS <a class="board-drag-handle" tooltip="Drag board"><img src="assets/icons/board-dots2.svg"></a> -->
                      </div>
                    </div>
                  </div>
                </div>
                <div class="board-body">
                  <!-- DON'T MODIFY BELOW -->
                  <draggable filter=".dont-drag-this" v-if="board" :id="'aikomail--' + boardName" v-model="board.emails"
                    :group="{name: 'emails'}" ghost-class="ghost" @end="moveEmail" @start="startMove"
                    :force-fallback="true" :fallback-on-body="true" :fallback-tolerance="0" draggable=".email">
                    <!-- Single Email ---------- add class 'drag' when dragged ------->
                    <email-card :board="boardName"
                      v-if="email.folder == boardName && !(email?.ai?.threaded == boardName)"
                      :key="boardName + email.uid" v-for="(email, i) in board?.emails" :index="i"
                      :focused-folder.camel="focused.folder" :focused-index.camel="focused.index"
                      :view-focused.camel="focused.view" :quick-focused.camel="focused.quickReply" :email="email">
                    </email-card>
                  </draggable>
                  <div class="empty" v-if="board?.emails?.length == 0">
                    <h1>Drag emails here.</h1>
                  </div>
                </div>
              </div>
            </board>
          </draggable>

          <!-- START Done Board Template ----------------------->
          <div :class="{
            'board': true,
            'load-board': syncingDone
          }">
            <div class="board-header">
              <div class="container p0">
                <div class="row">
                  <div class="col-2 cll">
                    <div class="dropdown">
                      <a tooltip="Board options" data-toggle="dropdown"><img src="assets/icons/board-dots.svg"></a>
                      <div class="dropdown-menu">
                        <h6 class="dropdown-header">Actions</h6>
                        <a class="dropdown-item">Mark all as read</a>
                        <a class="dropdown-item">Mark all as unread</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item">Board rules</a>
                      </div>
                    </div>
                  </div>
                  <div class="col-8 text-center p0 exp margin-auto nowrap">
                    <h1>Done</h1>
                    <div class="archive cll" tooltip="Trash entire board"><img
                        src="assets/icons/sidebar-trash.svg">Trash
                      all</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="board-body">
              <!-- DON'T MODIFY BELOW -->
              <draggable filter=".dont-drag-this" v-if="done" id="aikomail--done" v-model="done.emails"
                :group="{name: 'emails'}" ghost-class="ghost" @end="moveEmail" @start="startMove" :force-fallback="true"
                :fallback-on-body="true" :fallback-tolerance="0" draggable=".email">
                <!-- Single Email ---------- add class 'drag' when dragged ------->
                <email-card :board="folderNames.done"
                  v-if="email.folder == folderNames.done && !(email?.ai?.threaded == '[Aiko Mail]/Done')"
                  :key="folderNames.done + email.uid" v-for="(email, i) in done.emails" :index="i"
                  :focused-folder.camel="focused.folder" :focused-index.camel="focused.index"
                  :view-focused.camel="focused.view" :quick-focused.camel="focused.quickReply" :email="email">
                </email-card>
              </draggable>
              <div class="empty" v-if="done?.emails?.length == 0">
                <h1>Drag emails here.</h1>
              </div>
            </div>
          </div>

          <div class="long-board">
            <!-- copy <div class="main-email"> template here when needed-->
          </div>

          <div class="add-board" @click="addBoard = true">
            <img src="assets/icons/boards-add.svg">
          </div>

        </div>
      </div>
    </div>

    <!-- INVITE MODAL --------------------------------------->
    <div class="aiko-modal" style="display: none;">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-reg">
            <img src="assets/icons/sidebar-invite.svg" width="40" style="margin-bottom: 5px;">
            <h1>Invite a team member</h1>
            <h2>Enter their email address</h2>
            <input type="email" name="" placeholder="Email">
            <p>We'll send them a link to Aiko Mail.</p>
            <br>
            <a class="blue">Done</a>
            <p class="ns30"></p>
            <br>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: Rig UPGRADE MODAL - QUICK ACTIONS -->
    <div class="aiko-modal" style="display: none;">
      <div class="modal-dialog modal-md">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" data-dismiss="modal" class="x-email">
          <div class="modal-reg">
            <img v-if="isDarkMode" src="assets/img/logo-white.svg" width="140"
              style="margin-bottom: 15px;margin-top:10px">
            <img v-if="!isDarkMode" src="assets/img/logo.svg" width="140" style="margin-bottom: 15px;margin-top:10px">
            <h1>You found a premium feature.</h1>
            <img v-if="isDarkMode" src="assets/img/u-quick-black.png" width="300">
            <img v-if="!isDarkMode" src="assets/img/u-quick-white.png" width="300">
            <br>
            <p style="max-width: 400px;margin: auto;margin-bottom: 10px;">Quick actions detects intent in your emails
              and lets you manage them with the click of a button.</p><br> <br>
            <div class="modal-bottom">
              <a class="blue">Get Started</a>
            </div>
            <p class="ns30"></p>
            <br>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: Rig UPGRADE MODAL - MAILBOX SWITCHER -->
    <div class="aiko-modal" style="display: none;">
      <div class="modal-dialog modal-md">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" data-dismiss="modal" class="x-email">
          <div class="modal-reg">
            <img v-if="isDarkMode" src="assets/img/logo-white.svg" width="140"
              style="margin-bottom: 15px;margin-top:10px">
            <img v-if="!isDarkMode" src="assets/img/logo.svg" width="140" style="margin-bottom: 15px;margin-top:10px">
            <h1>You found a premium feature.</h1>
            <img v-if="isDarkMode" src="assets/img/u-mailbox-black.png" width="250">
            <img v-if="!isDarkMode" src="assets/img/u-mailbox-white.png" width="250">
            <br> <br>
            <p style="max-width: 300px;margin: auto;margin-bottom: 10px;">Add email accounts and seamlessly switch
              between all your
              mailboxes.</p><br><br>
            <div class="modal-bottom">
              <a class="blue">Get Started</a>
            </div>
            <p class="ns30"></p>
            <br>
          </div>
        </div>
      </div>
    </div>

    <!-- TODO: Rig UPGRADE MODAL - Notifications teehee -->
    <div class="aiko-modal" style="display: none;">
      <div class="modal-dialog modal-md">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" data-dismiss="modal" class="x-email">
          <div class="modal-reg">
            <img v-if="isDarkMode" src="assets/img/logo-white.svg" width="140"
              style="margin-bottom: 15px;margin-top:10px">
            <img v-if="!isDarkMode" src="assets/img/logo.svg" width="140" style="margin-bottom: 15px;margin-top:10px">
            <h1>You found a premium feature.</h1>
            <img v-if="isDarkMode" src="assets/img/u-notif-black.png" width="300">
            <img v-if="!isDarkMode" src="assets/img/u-notif-white.png" width="300">
            <br><br>
            <p style="max-width: 300px;margin: auto;margin-bottom: 10px;">Upgrade today to get notified when
              someone opens your emails or joins your team.</p><br> <br>
            <div class="modal-bottom">
              <a class="blue">Get Started</a>
            </div>
            <p class="ns30"></p>
            <br>
          </div>
        </div>
      </div>
    </div>
    <!-- TUTORIAL MODAL -->
    <tutorial-modal v-if="firstTime" inline-template>
      <div class="aiko-modal">
        <div class="modal-dialog modal-md">
          <div class="modal-content">
            <div class="modal-reg">
              <h1>Welcome to Aiko Mail</h1>
              <h2>Watch this tutorial to get started!</h2>
              <!-- TODO: change this to tutorial video once we have one -->
              <video controls src="assets/videos/"></video>
            </div>
            <br><br>
            <div class="modal-bottom">
              <a @click="close" class="blue" style="float: right;">Skip Tutorial</a>
            </div>
          </div>
        </div>
      </div>
    </tutorial-modal>

    <!-- VIEW EMAIL -->
    <view-email tabindex="0" v-if="viewEmail" :emailcard="viewEmail" inline-template>
      <div tabindex="0" @click.self="close" class="aiko-modal">

        <div class="modal-dialog modal-lg">
          <p class="esc-tip">press <b>ESC</b></p>
          <div class="modal-content">

            <div class="main-email">
              <!-- TODO: Ruben, make sure shadow light mode not bad-->
              <!-- Newest Message in Thread  -->
              <view-email-single :validity="email?.validity || 0" :key="email.uid" :expanded="true"
                :emailsingle="email"></view-email-single>

              <!-- Message in Thread -->
              <view-email-single :validity="9999" :key="e.uid" :expanded="false"
                v-if="email.parsed.thread?.messages?.length > 0" :emailsingle="e"
                v-for="e in email?.parsed?.thread?.messages">
              </view-email-single>
            </div>
            <div class="secondary-email">
              <img @click="close" src="assets/icons/grey-x.svg" class="x-email">
              <div class="secondary-head">
                <div class="container">
                  <div class="row">
                    <div class="col-3 p0">

                      <img :src="avatar" style="	border-radius: 50%;
	width: 54px;
	height: 54px;
	position: relative;
	overflow: hidden;
	border: 3px solid var(--secondary-bg-color);
  background: var(--secondary-bg-color);
  ">

                    </div>
                    <div class="col-9 p0 spe hover-name">
                      <h1>{{sender.name}}</h1>
                      <h2>{{sender.address}}</h2>

                      <!-- TODO: Prirpi add options here? its a hover thingy-->
                      <p>NEW EMAIL</p> <!-- This is an option, could be anything we want really-->
                      <p>COPY</p> <!-- This is an option, could be anything we want really-->
                      <p>INVITE</p> <!-- This is an option, could be anything we want really-->
                    </div>
                  </div>
                </div>
              </div>

              <!-- ATTACHMENT ELEMENTS
              <div class="attachments">
                <h3>Attachments
                  <div class="secondary-count">12</div>
                  <a>Download all</a>
                </h3>

                <div class="attachment"><img src="assets/icons/music.svg">
                  <div class="name">grimeforprinis.mp3</div>
                  <div class="size">13MB</div>
                </div>

                <div class="attachment"><img src="assets/icons/music.svg">
                  <div class="name">grime.mp3</div>
                  <div class="size">1MB</div>
                </div>

                <div class="attachment"><img src="assets/icons/music.svg">
                  <div class="name">prinis.mp3</div>
                  <div class="size">3MB</div>
                </div>

              </div>
              -->
              <h3>Other conversations with {{sender.name}}</h3>
              <div class="previous-threads sec-sec">
                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>

                <div class="email thread">
                  <div class="container pr">
                    <div class="row" style="user-select: none;">
                      <div class="col-8 p0" style="display: inline-flex;">
                        <p class="subject">This is the subject</p>
                      </div>
                      <div class="col-4 p0">
                        <div class="time">6:18PM</div>
                      </div>

                      <p class="body">This is the main content of the email, it is suppose to be
                        longer than the subject and a summary of the main content.</p>
                    </div>
                  </div>
                </div>


              </div>
            </div>
          </div>
        </div>
      </div>
    </view-email>

    <!-- NEW MAILBOX MODAL --------------------------------------->
    <add-mailbox-modal :googlestrategy="google_addMailbox" v-if="addMailbox" :success="switchMailServer"
      :closable="!forceAddMailbox" inline-template>
      <div class="aiko-modal add-mailbox">
        <!-- STEP ONE --->
        <div class="modal-dialog modal-md" v-if="step == 1">
          <div class="modal-content">
            <img @click="close" v-if="closable" src="assets/icons/grey-x.svg" class="x-email">
            <div class="modal-reg">
              <h1>Add a mailbox</h1>
              <h2>Pick an email provider</h2>
              <!-- <a><img src="assets/img/icloud.png"></a> -->
              <a><img @click="addMicrosoft" src="assets/img/exchange.png"></a>
              <a><img @click="addGoogle" src="assets/img/google.png"></a>
              <!-- <a><img src="assets/img/yahoo.png"></a> -->
              <!-- <a><img src="assets/img/aol.png"></a> -->
              <a><img @click="addMicrosoft" src="assets/img/outlook.png"></a>
              <br>
            </div>
            <div class="modal-bottom">
              <a @click="addOther">Other</a>
            </div>
          </div>
        </div>
        <!-- STEP TWO --->
        <div class="modal-dialog modal-md" v-if="step == 2">
          <div class="modal-content">
            <div class="modal-reg">
              <h1>Add a mailbox</h1>
              <h2>Enter your credentials</h2>
              <a>
                <!-- TODO: use clearbit to auto-show the user's email provider -->
                <img v-if="imapConfig.provider == 'microsoft'" src="assets/img/outlook.png">
              </a>
              <p v-if="error" class="alert alert-danger">{{error}}</p>
              <input v-model="imapConfig.user" type="email" name="" placeholder="Email">
              <input v-model="imapConfig.pass" type="password" name="" placeholder="Password">
              <input v-model="imapConfig.host" type="url" name="" placeholder="IMAP Host">
              <input v-model="imapConfig.port" type="number" name="" placeholder="IMAP Port">
              <input v-model="smtpConfig.host" type="url" name="" placeholder="SMTP Host">
              <input v-model="smtpConfig.port" type="number" name="" placeholder="SMTP Port">
              <br><br>
              <a v-if="!loading" @click="saveConfig" class="blue">Add mailbox</a>
              <!-- TODO: CHANGE LOADER HERE RUBEN-->
              <div v-if="loading" class="cs-loader">
                <div class="cs-loader-inner">
                  <label> ●</label>
                  <label> ●</label>
                  <label> ●</label>
                  <label> ●</label>
                  <label> ●</label>
                  <label> ●</label>
                </div>
              </div>
              <br><br>
            </div>
            <div v-if="!loading" class="modal-bottom">
              <a @click="back">Back</a>
            </div>
          </div>
        </div>

      </div>
    </add-mailbox-modal>

    <!-- TODO: Make it impossible to name a board like an existing one ------------->
    <!-- NEW BOARD MODAL --------------------------------------->
    <add-board-modal v-if="addBoard" inline-template>
      <div class="aiko-modal addb" @click.self="close">
        <!-- STEP 1 - BOARD NAME --->
        <div v-if="step == 1" class="modal-dialog modal-sm">
          <div class="modal-content">
            <img @click="close" src="assets/icons/grey-x.svg" class="x-email">
            <div class="modal-reg">
              <img src="assets/icons/new-board.svg" width="40" style="margin-bottom: 5px;">
              <h1>Add a board</h1>
              <h2>Enter a name for your board</h2>
              <input v-model="name" type="text" placeholder="Board name" minlength="1" maxlength="13" class="cap"
                style="margin-top: -20px;">
              <br><br>
              <div v-if="validBoard" class="modal-bottom">
                <!-- TODO: change this to do step = 2 and then rig the board rules -->
                <a @click="addBoard" class="blue">Next</a>
              </div>
              <br>
            </div>
          </div>
        </div>
        <!-- STEP 2 - BOARD RULES (New Board only)--->
        <div v-if="step == 2" class="modal-dialog modal-md">
          <div class="modal-content">
            <img src="assets/icons/grey-x.svg" class="x-email">
            <div class="modal-reg">
              <img src="assets/icons/new-board.svg" width="40" style="margin-bottom: 5px;">
              <h1>Board rules (optional)</h1>
              <br>
              <div class="accordion" id="accordionExample">
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h2 class="mb-0">
                      <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                        aria-expanded="true" aria-controls="collapseOne">
                        Add automatic forwarding
                      </button>
                    </h2>
                  </div>
                  <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                    <div class="card-body">
                      <p style="margin-bottom: 12px;">Dragging an email to this board will forward it to:</p>
                      <input type="text" name="rulesField" placeholder="Email">
                    </div>
                  </div>
                </div>
              </div>
              <p style="margin-top: 20px;margin-bottom: -15px">You can add or change rules later.</p>
              <br><br><br>
              <div class="modal-bottom">
                <a class="blue">Add board</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </add-board-modal>

    <dev-controls v-if="showDev" :delete-cache.camel="deleteCache" inline-template>
      <div style="z-index: 9999" class="aiko-modal" @click.self="close">
        <div class="modal-dialog modal-md">
          <div class="modal-content">
            <div class="modal-reg">
              <h1>Developer Controls</h1>
              <a>
                <img style="max-width: 190px; margin: auto" src="assets/img/logo.svg">
              </a>
              <br>
              <br>
              <a @click="deleteCache(emails=true)" class="btn btn-warning">Clear Email Cache</a>
              <br>
              <br>
              <a @click="deleteCache(prefs=true)" class="btn btn-warning">Clear Settings</a>
              <br>
              <br>
              <a @click="deleteCache(chrome=true)" class="btn btn-warning">Clear Inbox Cache</a>
              <br>
              <br>
              <a @click="deleteCache(emails=true, prefs=true, chrome=true)" class="btn btn-danger text-white">Clear ALL
                Cache</a>
              <br>
              <br>
              <a @click="testIMAP" class="btn btn-dark text-white">Test IMAP Connection</a>
              <img v-if="imapValid === true" style="filter: invert(1)" src="assets/icons/check.svg">
              <img v-if="imapValid === false" src="assets/icons/x-white.svg">
              <br>
              <br>
              <a @click="testSMTP" class="btn btn-dark text-white">Test SMTP Connection</a>
              <img v-if="smtpValid === true" style="filter: invert(1)" src="assets/icons/check.svg">
              <img v-if="smtpValid === false" src="assets/icons/x-white.svg">
              <br>
              <br>
              <a @click="testConnection" class="btn btn-light">Test Mail Connection</a>
              <br>
              <br>
              <br>
            </div>
            <div class="modal-bottom text-center">
              <a @click="close">Close</a>
            </div>
          </div>
        </div>

      </div>
    </dev-controls>


    <!-- BOARD RULES (Board already exists) --------------------------------------->
    <div class="aiko-modal" style="display: none;">
      <div class="modal-dialog modal-md">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" class="x-email">
          <div class="modal-reg">
            <img src="assets/icons/new-board.svg" width="40" style="margin-bottom: 5px;">
            <h1><b>{BOARD NAME}</b> board rules</h1>
            <br>
            <div class="accordion" id="accordionExample">
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                      aria-expanded="true" aria-controls="collapseOne">
                      Automatic forwarding
                    </button>
                  </h2>
                </div>
                <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                  <div class="card-body">
                    <p style="margin-bottom: 12px;">Dragging an email to this board forwards it to:</p>
                    <input type="text" name="rulesField" placeholder="Email">
                  </div>
                </div>
              </div>
            </div>
            <p style="margin-top: 20px;margin-bottom: -15px">Check your <a class="blue fw600">Inbox board
                rules</a> to see if emails are being automatically added to this board.</p>
            <br><br><br>
            <div class="modal-bottom">
              <a class="blue">Save</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP ONE - INBOX Board rules --------------------------------------->
    <div class="aiko-modal" style="display: none">
      <div class="modal-dialog modal-md mw600">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" class="x-email">
          <div class="modal-reg">
            <img src="assets/icons/new-board.svg" width="40" style="margin-bottom: 5px;">
            <h1><b>Inbox</b> board rules</h1>
            <br>
            <div class="container-rules">
              <div class="row margin-auto existing-rules">
                <div class="col-3">
                  <p class="margin-auto text-left">if from: </p>
                </div>
                <div class="col-3">
                  <p class="margin-auto blue text-left">ruben@pri.com</p>
                </div>
                <div class="col-2">
                  <p class="margin-auto text-left">move to: </p>
                </div>
                <div class="col-2">
                  <p class="margin-auto blue">To-Do</p>
                </div>
                <div class="col-2">
                  <a class="red margin-auto text-right">Delete</a>
                </div>
              </div>

              <div class="row margin-auto existing-rules">
                <div class="col-3">
                  <p class="margin-auto text-left">Contains: </p>
                </div>
                <div class="col-3">
                  <p class="margin-auto blue text-left">salsa</p>
                </div>
                <div class="col-2">
                  <p class="margin-auto text-left">move to: </p>
                </div>
                <div class="col-2">
                  <p class="margin-auto blue">Done</p>
                </div>
                <div class="col-2">
                  <a class="red margin-auto text-right">Delete</a>
                </div>
              </div>

              <div class="row margin-auto existing-rules">
                <div class="col-3">
                  <p class="margin-auto text-left">if from: </p>
                </div>
                <div class="col-3">
                  <p class="margin-auto blue text-left">jojo@pri.com</p>
                </div>
                <div class="col-2">
                  <p class="margin-auto text-left">move to: </p>
                </div>
                <div class="col-2">
                  <p class="margin-auto blue">From Jo</p>
                </div>
                <div class="col-2">
                  <a class="red margin-auto text-right">Delete</a>
                </div>
              </div>

              <div class="row margin-auto existing-rules">
                <div class="col-3">
                  <p class="margin-auto text-left">if from: </p>
                </div>
                <div class="col-3">
                  <p class="margin-auto blue text-left">ruben@pri.com</p>
                </div>
                <div class="col-2">
                  <p class="margin-auto text-left">move to: </p>
                </div>
                <div class="col-2">
                  <p class="margin-auto blue">To-Do</p>
                </div>
                <div class="col-2">
                  <a class="red margin-auto text-right">Delete</a>
                </div>
              </div>
            </div>
            <br>
            <a class="blue">Add new rule</a>
          </div>
        </div>
      </div>

      <!-- STEP TWO - INBOX BOARD ADD RULE --------------------------------------->
      <div class="modal-dialog modal-md mw600" style="display: none;">
        <div class="modal-content">
          <img src="assets/icons/grey-x.svg" class="x-email">
          <div class="modal-reg">
            <img src="assets/icons/new-board.svg" width="40" style="margin-bottom: 5px;">
            <h1>Add rule</h1>
            <div class="accordion" id="accordionExample">
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
                      aria-expanded="true" aria-controls="collapseOne">
                      Add email address filter ("if email is from...")
                    </button>
                  </h2>
                </div>
                <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-4 text-right">
                          <p>Move email to: </p>
                        </div>
                        <div class="col-4 text-center">
                          <select class="aiko-select">
                            <option value="1" selected="selected">To-Do</option>
                            <option value="2">Done</option>
                          </select>
                        </div>
                        <div class="col-4 text-left">
                          <p>if it's from:</p>
                        </div>
                      </div>
                      <br>
                      <input type="text" name="rulesField" placeholder="Email">
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-header" id="headingOne">
                  <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseTwo"
                      aria-expanded="true" aria-controls="collapseOne">
                      Add subject keyword filter ("if subject contains...")
                    </button>
                  </h2>
                </div>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-4 text-right">
                          <p>Move email to: </p>
                        </div>
                        <div class="col-4 text-center">
                          <select class="aiko-select">
                            <option value="1" selected="selected">To-Do</option>
                            <option value="2">Done</option>
                          </select>
                        </div>
                        <div class="col-4 text-left">
                          <p>if subject contains:</p>
                        </div>
                      </div>
                      <br>
                      <input type="text" name="rulesField2" placeholder="Word">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <p style="margin-top: 20px;margin-bottom: 0">Check individual board rules to see dragging actions.</p>
            <br><br>
            <div class="modal-bottom">
              <a class="backbtn float-left">Back</a><a class="blue float-right">Save rule</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="text/x-template" id="email-card">
    <!-- TODO: add 'quick-reply' class to 'email' class here, when click quick reply teehee -->
    <div @blur="unfocus" :ref="email.folder + ':' + email.uid" :key="email.uid" :uid="email.uid" class="email" :class="{
        'unread': !(email?.ai?.seen),
        'zero': !(email?.ai?.summary?.sentences?.length > 0),
        'syncing': email?.syncing,
        'dont-drag-this': email?.syncing,
        'starred': email?.ai?.starred,
        'focus': email?.folder == focusedFolder && index == focusedIndex
      }" v-if="!email?.ai?.deleted">
      <div v-if="render !== false" class="container pr" @click="viewMessage">
        <div class="row" style="user-select: none;">
          <div class="col-8 p0 exp" style="display: inline-flex;">
            <h2 v-if="email?.parsed?.thread?.senders.length" class="sender">
              {{email?.parsed?.thread?.senders?.tail(3)?.reverse()?.join(', ')}}
            </h2>

            <h2 v-else class="sender" @click="debug">
              {{(email?.envelope?.from?.[0]?.name || email?.envelope?.from?.[0]?.address || 'No Sender')}}
            </h2>
            <img v-if="email?.ai?.thread" src="assets/icons/th.svg">
            <span class="thread-count" v-if="email?.parsed?.thread?.messages?.length > 0">{{email.parsed?.thread?.messages?.length}}</span>
            <img v-if="email?.parsed?.attachments?.length > 0" src="assets/icons/badges-attach.svg">
            <img v-if="email?.ai?.tracker" src="assets/icons/badges-tracker.svg">
            <img v-if="email?.ai?.intents?.calendar" src="assets/icons/badges-event.svg">
            <img v-if="email?.parsed?.bcc" src="assets/icons/badges-bcc.svg">
          </div>
          <div class="col-4 p0 cll">
            <div class="time">{{new Date(email?.envelope?.date).toNiceDateTime()}}</div>
          </div>
          <p class="subject">{{email?.envelope?.subject}}</p>
          <p v-if="email?.ai?.summary?.sentences?.length > 0" class="body">{{email?.ai?.summary?.text}}</p>
        </div>
        <div class="email-footer dont-drag-this" style="user-select: none;">
          <div class="row">
            <div class="col-5 cll cll2 z1">
              <a v-if="email?.ai?.intents?.main == 'schedule'" class="main-action ma2">
                <img src="assets/icons/badges-event-blue.svg"> Schedule
              </a>
              <a @click.stop.prevent="openVerify" v-if="email?.ai?.intents?.main == 'verify'" class="main-action ma2">
                <img src="assets/icons/link.svg"> Verify
              </a>
              <a v-if="email?.ai?.intents?.main == 'subscribe'" class="main-action ma2">
                <img src="assets/icons/link.svg"> Subscribe
              </a>
              <a v-if="email?.ai?.intents?.main == 'unsubscribe'" class="main-action ma3">
                <img src="assets/icons/options-unsub.svg"> Unsubscribe
              </a>
              <a v-if="email?.ai?.intents?.main == 'sign'" class="main-action ma2">
                <img src="assets/icons/sign.svg"> Sign
              </a>
              <a @click.stop.prevent="showQuickReply = true" v-if="email?.ai?.intents?.main == null"
                class="main-action ma1">
                <img src="assets/icons/zap.svg"> Quick Reply <span @click="quickReplyAll = true" class="all">All</span>
              </a>
            </div>
            <div class="col-5 sync-message">
              <a class="main-action ma1">
                <img src="assets/icons/refresh.svg" class="rotating ml5"> Syncing
              </a>
            </div>
            <div class="col-7 extra-actions cll2">
              <a @click.stop.prevent="reply"><img src="assets/icons/options-reply.png" width="18"></a>
              <a @click.stop.prevent="replyAll"><img src="assets/icons/options-replya.png" width="18"></a>
              <a @click.stop.prevent="forward"><img src="assets/icons/options-forward.png" width="15"></a>
              <a @click.stop.prevent="starMessage" v-if="!(email?.ai?.starred)"><img src="assets/icons/options-star.svg"
                  width="15"></a>
              <a @click.stop.prevent="unstarMessage" v-if="email?.ai?.starred"><img src="assets/icons/badges-star.svg"
                  width="15"></a>
              <a @click.stop.prevent="deleteMessage"><img src="assets/icons/options-trash.svg" class="red"
                  width="15"></a>
            </div>
          </div>
        </div>
        <div :class="{
          'note': true,
          'hide': !showQuickReply,
          'dont-drag-this': true
        }">
          <input @keydown.esc.stop.prevent="unfocus" @click.stop="focus" ref="quickreply" @blur="unfocus"
            v-model="replyText" placeholder="Type a reply..." autofocus>
          <a @click.stop="sendQuickReply"><img src="assets/icons/compose-send.svg" width="20"></a>
        </div>
      </div>
      <div :uid="email?.uid" style="height: 106px;" v-else></div>
    </div>
  </script>

  <script type="text/x-template" id="view-email-single">
    <div :class="{
      'single-email': true,
      'short': !expanded
    }">
      <div class="email-head" @click="expanded = !expanded">
        <div class="container">
          <div class="row sender-top">
            <div class="col-8 p0" style="display: inline-flex;height: 22px;">
              <h2 class="sender">
                {{(sender.address == $root.currentMailbox && "Me") || sender.name || sender.address}}</h2>
              <img v-if="email?.parsed?.attachments?.length > 0" src="assets/icons/badges-attach.svg">
              <img v-if="email?.ai?.tracker" src="assets/icons/badges-tracker.svg">
              <img v-if="email?.ai?.intents?.calendar" src="assets/icons/badges-event.svg">
              <img v-if="email?.parsed?.bcc" src="assets/icons/badges-bcc.svg">
              <select v-if="email.folder != $root.folderNames.archive" class="aiko-select v1" onmousedown="(function(e){ e.preventDefault(); })(event, this)">
                <option v-if="board.folder == email.folder" v-for="(board, i) in boards" :selected="board.folder == email.folder" :value="i">{{board.name}}</option>
                <option v-else-if="email.folder == '[Aiko Mail]/Done'" selected :value="-2">Done</option>
                <option v-else selected :value="-1">{{email.folder}}</option>
              </select>
              <!-- FUTURE DROP DOWN FOR BOARD CHANGE
              <select class="aiko-select">
                <option v-for="(board, i) in boards" :selected="board.folder == email.folder" :value="i">{{board.name}}</option>
              </select>
              -->
            </div>
            <div class="col-4 p0">
              <div class="time">{{new Date(email?.envelope?.date).toNiceDateTime()}}</div>
            </div>
          </div>
          <div v-if="to.length == 1" class="row">
            <h2 class="fromto-info">
            <!-- TODO: Change 'to' to real 'to' address-->
            <!-- TODO: remove 'hide' when needed-->
            <b>From</b> <span>{{sender.address}}</span> <b>to</b> <span>{{to[0].address}}</span> <b v-if="cc.length > 0">and {{cc.length}} others</b>
            <div class="more-fromto hide">
              <b>CC </b> <span>rubentouitou@teehee.teehee</span>
            <br><b>BCC </b> <span>rubentouitou@teehee.teehee</span>
          </div>
        </h2>
          </div>
          <div v-else class="row">
            <h2 class="fromto-info">
            <!-- TODO: Change 'to' to real 'to' address-->
            <b>From</b> <span>{{sender.address}}</span> <b>to</b> <span v-for="recipient in to.slice(0, 2)">{{recipient.address}}, </span> <b v-if="to.length > 2 || cc.length > 0">and {{Math.max(to.length - 2, 0) + cc.length}} others</b>
            <div class="more-fromto hide">
              <b>CC </b> <span>rubentouitou@teehee.teehee</span>
              <br><b>BCC </b> <span>rubentouitou@teehee.teehee</span>
            </div>
          </div>
          </h2>
          <div class="row">
            <h3>{{email?.envelope?.subject}}</h3>
          </div>
        </div>

        <div class="options-qa">
          <a target="_blank" v-if="email?.ai?.intents?.main == 'schedule'">
            <h2 class="action ma2"><img src="assets/icons/email-schedule.svg">Schedule</h2>
          </a>
          <a target="_blank" v-if="email?.ai?.intents?.main == 'verify'">
            <h2 class="action ma2"><img src="assets/icons/link.svg">Verify</h2>
          </a>
          <a target="_blank" v-if="email?.ai?.intents?.main == 'subscribe'">
            <h2 class="action ma2"><img src="assets/icons/link.svg">Subscribe</h2>
          </a>
          <a target="_blank" v-if="email?.ai?.intents?.main == 'unsubscribe'">
            <h2 class="action  ma3"><img src="assets/icons/options-unsub.svg">Unsubscribe</h2>
          </a>
          <a target="_blank" v-if="email?.ai?.intents?.main == 'sign'">
            <h2 class="action ma2"><img src="assets/icons/link.svg">Sign</h2>
          </a>
        </div>

        <div class="options">
          <div class="container">
            <div class="row">
                <a @click.stop="reply" tooltip="Reply"><img src="assets/icons/options-reply.png" width="20"></a>
                <a @click.stop="replyAll" tooltip="Reply All"><img src="assets/icons/options-replya.png" width="20"></a>
                <a @click.stop="forward" tooltip="Forward"><img src="assets/icons/options-forward.png" width="20"></a>
                <a tooltip="Star" @click.stop.prevent="starMessage" v-if="!(email?.ai?.starred)"><img src="assets/icons/options-star.svg"
                  width="20"></a>
                <a tooltip="Unstar" @click.stop.prevent="unstarMessage" v-if="email?.ai?.starred"><img src="assets/icons/badges-star.svg"
                    width="20"></a>
                <a tooltip="Trash" @click.stop.prevent="deleteMessage"><img src="assets/icons/options-trash.svg" class="red"
                    width="20"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="email-body">
        <div v-if="false" class="scheduler">
                <p tooltip="Click to change date and time">Tomorrow at 10:30AM</p>
                <a><img src="assets/icons/event-white.svg" width="20" /><span>
                    Schedule</span></a>
                    <div class="scheduler2">
                      <!-- TODO: Add calendar view here 
                      + design it-->
                    </div>
                    <!-- TODO: Not sure what to use this text for yet-->
                    <span class="sc-info">This will open the composer</span>
        </div>
        <div v-if="!(email?.parsed) || loading" class="load-bottom">
          <p>Loading email</p>
        </div>
        <!-- FIXME: using iframe right now, will be insecure until I safely inject HTML, see
        https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page -->
        <iframe scrolling="no" frameborder="no" class="html-content email-iframe" :id="iframeId" src="">
        </iframe>
      </div>
    </div>
  </script>

  <!-- 3rd party libraries -->
  <script src="assets/js/third-party/popper.min.js"></script>
  <script src="assets/js/third-party/jquery.amsify.suggestags.js"></script>
  <script src="assets/js/third-party/bootstrap.min.js"></script>
  <script src="assets/js/third-party/jwt-decode.min.js"></script>
  <script src="assets/js/third-party/jsrsasign.min.js"></script>
  <script src="assets/js/third-party/localforage.min.js"></script>
  <script src="assets/js/third-party/sortable.min.js"></script>
  <script src="assets/js/third-party/vue.min.js"></script>
  <script src="assets/js/third-party/vue-draggable.min.js"></script>
  <script src="assets/js/third-party/chrono.min.js"></script>
  <script src="assets/js/third-party/crypto.js"></script>
  <script src="assets/js/third-party/hotkeys.min.js"></script>

  <!-- TODO: minify all sources into one js file -->
  <!-- common libraries -->
  <script src="assets/js/common/utils.js"></script>
  <script src="assets/js/common/small-storage.js"></script>
  <script src="assets/js/common/big-storage.js"></script>
  <script src="assets/js/common/only-electron.js"></script>
  <script src="assets/js/common/ai-core.js"></script>
  <script src="assets/js/common/mailcleaner.js"></script>
  <!-- services -->
  <script src="assets/js/services/ipc.js"></script>
  <script src="assets/js/services/aiko.js"></script>
  <script src="assets/js/services/window.js"></script>
  <script src="assets/js/services/goauth.js"></script>
  <script src="assets/js/services/mail.js"></script>
  <script src="assets/js/services/composer.js"></script>
  <script src="assets/js/services/modals.js"></script>
  <script src="assets/js/services/shortcuts.js"></script>
  <script src="assets/js/services/visual.js"></script>
  <!-- templates -->
  <script src="assets/js/components/modals/tutorial.js"></script>
  <script src="assets/js/components/modals/add-mailbox.js"></script>
  <script src="assets/js/components/modals/view-email.js"></script>
  <script src="assets/js/components/modals/add-board.js"></script>
  <script src="assets/js/components/modals/dev-controls.js"></script>
  <script src="assets/js/components/email-card.js"></script>
  <script src="assets/js/components/view-email-single.js"></script>
  <script src="assets/js/components/board.js"></script>
  <!-- main/entrypoint -->
  <script src="assets/js/main.js"></script>

</body>

</html>